import json
import logging
from typing import (
    Any,
    AsyncGenerator,
    AsyncIterable,
    Generator,
    List,
    Optional,
    Tuple,
    Type,
    Union,
)

from pydantic import BaseModel, ValidationError


def dump_json_str(obj: Any) -> str:
    return json.dumps(dump_json(obj), ensure_ascii=False, default=lambda x: str(x))


def dump_json(obj: Any) -> Any:
    if isinstance(obj, dict):
        return {k: dump_json(v) for k, v in obj.items()}
    elif isinstance(obj, (tuple, list)):
        return [dump_json(v) for v in obj]
    elif isinstance(obj, BaseModel):
        return obj.model_dump(exclude_unset=True, exclude_none=True)
    elif isinstance(obj, (AsyncGenerator, Generator, AsyncIterable)):
        return str(obj)
    else:
        return obj